<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Crear Itinerario</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding" [fullscreen]="true">
  <!-- Contenedor para asegurar que el stepper tenga altura completa -->
  <div style="min-height: 100%">
    <mat-horizontal-stepper #stepper>
      <!-- ===================== PASO 1: Agregar rutas ===================== -->
      <mat-step label="Agregar rutas">
        <ion-grid>
          <ion-row class="g-3 justify-content-center">
            <ion-col
              size="12"
              size-sm="6"
              size-md="4"
              *ngFor="let item of itinerary; let i = index"
            >
              <ion-card>
                <!-- Boton eliminar -->
                <div
                  *ngIf="
                    itinerary.length > 1 &&
                    (item.title.trim() ||
                      item.time.trim() ||
                      item.description.trim())
                  "
                  class="position-absolute top-0 end-0 m-2 d-flex gap-1"
                  style="z-index: 10"
                >
                  <ion-button
                    fill="solid"
                    color="danger"
                    size="small"
                    (click)="deleteCard(i)"
                  >
                    <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
                  </ion-button>
                </div>

                <!-- Contenido centrado -->
                <div
                  class="d-flex flex-column justify-content-center align-items-center w-100"
                >
                  <ion-input
                    placeholder="Escribe un lugar..."
                    [(ngModel)]="item.title"
                    [ngModelOptions]="{ standalone: true }"
                    (click)="openDetails(i)"
                    class="text-light bg-transparent border-secondary text-center mb-3"
                  >
                  </ion-input>
                </div>
              </ion-card>
            </ion-col>
          </ion-row>
        </ion-grid>

        <!-- Botón Siguiente -->
        <div class="mt-3">
          <button mat-button matStepperNext [disabled]="!hasFilledCard()">
            Siguiente
          </button>
        </div>
      </mat-step>

      <!-- ===================== PASO 2: Chat IA ===================== -->
      <mat-step label="Chat IA">
        <p>Paso 2: IA simulando optimización de rutas...</p>

        <ion-button
          expand="block"
          color="primary"
          (click)="generateOptimizedRoute()"
        >
          Generar ruta optimizada
        </ion-button>

        <div *ngIf="optimizedItinerary.length">
          <h3>Rutas optimizadas simuladas:</h3>
          <ion-list>
            <ion-item *ngFor="let item of optimizedItinerary">
              {{ item.routeOrder }}. {{ item.title }} - {{ item.time }} ({{
                item.estimatedTravelTime
              }}
              min)
            </ion-item>
          </ion-list>
        </div>

        <div class="d-flex justify-content-between mt-3">
          <button mat-button matStepperPrevious>Atrás</button>
          <button mat-button matStepperNext>Siguiente</button>
        </div>
      </mat-step>

      <!-- ===================== PASO 3: Verificar ruta en el mapa ===================== -->
      <!-- ===================== PASO 3: Verificar ruta en el mapa ===================== -->
      <mat-step label="Mapa">
        <p>Aquí se verá el recorrido optimizado en Google Maps.</p>

        <div
          id="map"
          style="
            width: 100%;
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
          "
        ></div>

        <div class="d-flex justify-content-between mt-3">
          <button mat-button matStepperPrevious>Atrás</button>
          <button mat-button color="primary" (click)="guardarItinerario()">
            Finalizar
          </button>
        </div>
      </mat-step>
    </mat-horizontal-stepper>
  </div>
</ion-content>
